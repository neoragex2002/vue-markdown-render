import{_ as i,c as a,o as e,ag as t}from"./chunks/framework.C0wiDQbp.js";const c=JSON.parse('{"title":"API 指南","description":"","frontmatter":{},"headers":[],"relativePath":"zh/guide/api.md","filePath":"zh/guide/api.md"}'),n={name:"zh/guide/api.md"};function d(l,s,o,p,h,k){return e(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="api-指南" tabindex="-1">API 指南 <a class="header-anchor" href="#api-指南" aria-label="Permalink to &quot;API 指南&quot;">​</a></h1><p>本页串联解析器工具、渲染器 props 与自定义钩子，帮助你快速定位入口。搭配 <a href="/vue-markdown-render/zh/guide/usage.html">使用示例</a> 与 <a href="/vue-markdown-render/zh/guide/props.html">props</a> 页面一起阅读效果更佳。</p><h2 id="渲染流程速览" tabindex="-1">渲染流程速览 <a class="header-anchor" href="#渲染流程速览" aria-label="Permalink to &quot;渲染流程速览&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Markdown 字符串 → getMarkdown() → markdown-it-ts 实例</span></span>
<span class="line"><span>            ↓</span></span>
<span class="line"><span>   parseMarkdownToStructure() → AST (BaseNode[])</span></span>
<span class="line"><span>            ↓</span></span>
<span class="line"><span>   &lt;MarkdownRender&gt; → 节点组件（CodeBlockNode、ImageNode 等）</span></span></code></pre></div><p>可在任意阶段介入：</p><ul><li>直接传 <code>content</code>：组件自动解析。</li><li>传 <code>nodes</code>：自己在服务端/预处理阶段生成 AST 并复用。</li></ul><h2 id="解析器工具" tabindex="-1">解析器工具 <a class="header-anchor" href="#解析器工具" aria-label="Permalink to &quot;解析器工具&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Helper</th><th>作用</th><th>适用场景</th></tr></thead><tbody><tr><td><code>getMarkdown(msgId?, options?)</code></td><td>返回预配置的 <code>markdown-it-ts</code> 实例。</td><td>需调整 parser 选项（HTML、插件）或复用实例时。</td></tr><tr><td><code>parseMarkdownToStructure(content, md?)</code></td><td>生成渲染器使用的 AST。</td><td>服务端预解析、静态导出、或需在渲染前做校验时。</td></tr></tbody></table><p>两者均可在 Node/浏览器使用。处理大文档时可复用 <code>md</code> 实例避免重复初始化插件。</p><h2 id="自定义组件与作用域" tabindex="-1">自定义组件与作用域 <a class="header-anchor" href="#自定义组件与作用域" aria-label="Permalink to &quot;自定义组件与作用域&quot;">​</a></h2><p>通过 <code>setCustomComponents(customId?, mapping)</code> 覆盖任意节点渲染器，再在 <code>MarkdownRender</code> 上传入匹配的 <code>custom-id</code>，即可限定覆盖范围。</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setCustomComponents } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;markstream-vue&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CustomImageNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./CustomImageNode.vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCustomComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;docs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  image: CustomImageNode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">MarkdownRender</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> custom-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">md</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span></code></pre></div><p>提示：</p><ul><li>使用语义化 ID（如 <code>docs</code>、<code>playground</code>）方便排查。</li><li><code>setCustomComponents(undefined, mapping)</code> 会注册全局映射；更推荐按 ID 作用域隔离。</li><li>在 SPA 中按需注册/卸载时，记得在路由切换时清理。</li></ul><h2 id="解析钩子与节点变换" tabindex="-1">解析钩子与节点变换 <a class="header-anchor" href="#解析钩子与节点变换" aria-label="Permalink to &quot;解析钩子与节点变换&quot;">​</a></h2><p>当使用 <code>content</code> 时，可通过 <code>parse-options</code>（组件 prop）或 <code>parseMarkdownToStructure</code> 的 <code>ParseOptions</code> 拦截解析阶段：</p><ul><li><code>preTransformTokens(tokens)</code> — 生成节点前预处理 token。</li><li><code>postTransformTokens(tokens)</code> — 在默认处理后继续调整。</li><li><code>postTransformNodes(nodes)</code> — 最终 AST 可在此注入元数据或拆分合并节点。</li></ul><p>示例：把 AI “thinking” 标签直接渲染成自定义组件（无需钩子）</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setCustomComponents } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;markstream-vue&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThinkingNode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./ThinkingNode.vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCustomComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;docs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { thinking: ThinkingNode })</span></span></code></pre></div><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">MarkdownRender</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  custom-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docs&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">custom-html-tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;thinking&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/&gt;</span></span></code></pre></div><p>如果你需要进一步改造 <code>thinking</code> 节点（剥掉包裹、重映射 attrs、合并分段等），再使用上述 hooks。</p><h2 id="其他导出" tabindex="-1">其他导出 <a class="header-anchor" href="#其他导出" aria-label="Permalink to &quot;其他导出&quot;">​</a></h2><ul><li>节点组件：<code>CodeBlockNode</code>、<code>MarkdownCodeBlockNode</code>、<code>MermaidBlockNode</code>、<code>MathBlockNode</code>、<code>ImageNode</code> 等（详见 <a href="/vue-markdown-render/zh/guide/components.html">组件与节点渲染器</a>）。</li><li>工具：<code>VisibilityWrapper</code>、<code>NodeRenderer</code>、类型定义（参考 <a href="/vue-markdown-render/zh/guide/parser-api.html">/zh/guide/parser-api</a> 或 npm 上的 <code>stream-markdown-parser</code> README）。</li></ul><h2 id="样式-排障提醒" tabindex="-1">样式 &amp; 排障提醒 <a class="header-anchor" href="#样式-排障提醒" aria-label="Permalink to &quot;样式 &amp; 排障提醒&quot;">​</a></h2><ul><li>先引入 reset，再在 <code>@layer components</code> 导入 <code>markstream-vue/index.css</code>，防止 Tailwind/UnoCSS 覆盖。参考 <a href="/vue-markdown-render/zh/guide/tailwind.html">Tailwind 指南</a>。</li><li>各个同伴依赖（Monaco、Shiki、Mermaid、KaTeX）都需要自己的 CSS；缺失时通常表现为空白渲染。</li><li>使用 <code>custom-id</code> + <code>[data-custom-id=&quot;docs&quot;]</code> 来局部覆盖样式。</li><li>遇到样式异常时，依照 <a href="/vue-markdown-render/zh/guide/troubleshooting.html#css-looks-wrong-start-here">排查清单</a> 逐项检查。</li></ul><p>需要更多示例？打开 <a href="/vue-markdown-render/zh/guide/playground.html">Playground</a> 或运行 <code>pnpm play</code> 在本地实验解析/渲染组合。</p>`,27)])])}const g=i(n,[["render",d]]);export{c as __pageData,g as default};
