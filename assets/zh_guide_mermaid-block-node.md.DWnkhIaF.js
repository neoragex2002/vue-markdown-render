import{_ as i,c as a,o as e,ag as l}from"./chunks/framework.C0wiDQbp.js";const c=JSON.parse('{"title":"MermaidBlockNode (Component)","description":"","frontmatter":{},"headers":[],"relativePath":"zh/guide/mermaid-block-node.md","filePath":"zh/guide/mermaid-block-node.md"}'),t={name:"zh/guide/mermaid-block-node.md"};function n(o,s,h,d,p,k){return e(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="mermaidblocknode-component" tabindex="-1">MermaidBlockNode (Component) <a class="header-anchor" href="#mermaidblocknode-component" aria-label="Permalink to &quot;MermaidBlockNode (Component)&quot;">​</a></h1><p><code>MermaidBlockNode</code> 提供一个易于使用且可扩展的 Mermaid 渲染器，适用于需要在文档中内嵌交互式 Mermaid 图的场景。组件支持渐进式渲染、源码/预览切换、复制源码、导出 SVG，以及伪全屏查看（带缩放与拖拽）。</p><h2 id="props-关键" tabindex="-1">Props（关键） <a class="header-anchor" href="#props-关键" aria-label="Permalink to &quot;Props（关键）&quot;">​</a></h2><ul><li><code>node: any</code> — Mermaid 代码节点（必须）</li><li><code>isDark?: boolean</code> — 暗色模式开关</li><li><code>loading?: boolean</code> — 初始加载占位</li><li><code>maxHeight?: string | null</code> — 最大高度</li><li><code>isStrict?: boolean</code> — 开启 <code>securityLevel: &#39;strict&#39;</code> + DOMPurify，并禁用 HTML labels；用于渲染不可信的 Mermaid 输入（例如用户/LLM 生成的内容），防止 <code>&lt;script&gt;</code>、<code>javascript:</code> 链接或内联事件落入最终 SVG</li><li>Header/按钮控制（全部可选，默认 <code>true</code>）: <ul><li><code>showHeader</code> / <code>showModeToggle</code> / <code>showCopyButton</code> / <code>showExportButton</code> / <code>showFullscreenButton</code> / <code>showCollapseButton</code> / <code>showZoomControls</code></li></ul></li></ul><h2 id="slots" tabindex="-1">Slots <a class="header-anchor" href="#slots" aria-label="Permalink to &quot;Slots&quot;">​</a></h2><ul><li><code>header-left</code> — 替换左侧（默认是 Mermaid 图标 + 标签）</li><li><code>header-center</code> — 替换中间区域（默认 preview/source 切换）</li><li><code>header-right</code> — 替换右侧操作按钮（完整接管默认按钮）</li></ul><h2 id="emits" tabindex="-1">Emits <a class="header-anchor" href="#emits" aria-label="Permalink to &quot;Emits&quot;">​</a></h2><p>组件发出的事件都使用统一的 <code>MermaidBlockEvent</code> 对象，支持 <code>preventDefault()</code> 来阻止组件默认行为：</p><ul><li><code>copy</code> — 点击复制按钮，处理签名：<code>(ev: MermaidBlockEvent&lt;{ type: &#39;copy&#39;; text: string }&gt;)</code>（调用 <code>ev.preventDefault()</code> 可阻止组件默认的复制到剪贴板与 “Copied” 状态）</li><li><code>export</code> — 导出按钮点击，处理签名：<code>(ev: MermaidBlockEvent&lt;{ type: &#39;export&#39; }&gt;)</code></li><li><code>openModal</code> — 请求打开 pseudo-fullscreen，处理签名：<code>(ev: MermaidBlockEvent&lt;{ type: &#39;openModal&#39; }&gt;)</code>（组件内部 emit 名称为 <code>openModal</code>）</li><li><code>toggleMode</code> — 切换 <code>source | preview</code>，处理签名：<code>(target: &#39;source&#39; | &#39;preview&#39;, ev: MermaidBlockEvent&lt;{ type: &#39;toggleMode&#39;; target: &#39;source&#39; | &#39;preview&#39; }&gt;)</code>（组件内部 emit 名称为 <code>toggleMode</code>）</li></ul><h3 id="拦截示例" tabindex="-1">拦截示例 <a class="header-anchor" href="#拦截示例" aria-label="Permalink to &quot;拦截示例&quot;">​</a></h3><p>完全替换组件默认导出行为：</p><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { MermaidBlockEvent } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../../types/component-props&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ev</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* MermaidBlockEvent */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ev.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preventDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 组件在事件对象中暴露了 svgElement，直接使用它更方便</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> svgEl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ev.svgElement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SVGElement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">svgEl) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;No svg element available&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> svgString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XMLSerializer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">serializeToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(svgEl)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  uploadSvg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(svgString)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">MermaidBlockNode</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> :node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> @export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;onExport&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><blockquote><p>注意：<code>export</code> / <code>openModal</code> 事件的事件对象现已同时包含 <code>svgElement</code>（DOM 节点）和 <code>svgString</code>（已序列化的 SVG 字符串），任选其一使用更方便。</p></blockquote><h2 id="slot-示例-完全接管右侧操作按钮" tabindex="-1">Slot 示例：完全接管右侧操作按钮 <a class="header-anchor" href="#slot-示例-完全接管右侧操作按钮" aria-label="Permalink to &quot;Slot 示例：完全接管右侧操作按钮&quot;">​</a></h2><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">MermaidBlockNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showExportButton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;template #header-right&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;button @click=&quot;downloadSvg&quot;&gt;Download&lt;/button&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;button @click=&quot;openCustomModal&quot;&gt;Open custom modal&lt;/button&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/template&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">MermaidBlockNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="推荐用法" tabindex="-1">推荐用法 <a class="header-anchor" href="#推荐用法" aria-label="Permalink to &quot;推荐用法&quot;">​</a></h2><ul><li>如果你要实现自定义导出/上传，最佳做法是：在 <code>export</code> 监听器中 <code>preventDefault()</code>，并在监听回调中直接从组件渲染的 DOM 中读取 <code>svg</code>。</li><li>如果你想要完全替换头部的 UI，使用 <code>header-*</code> 插槽并把相应 <code>show*</code> props 设为 <code>false</code> 来隐藏默认按钮。</li><li>若 Mermaid 内容来自用户/LLM 或任何不可信来源，建议加上 <code>:is-strict=&quot;true&quot;</code>，组件会对 SVG 进行清理并禁用 HTML labels，从而堵住恶意 <code>&lt;script&gt;</code> 或 <code>javascript:</code> 链接注入的风险。</li></ul><hr><p>如果你希望我现在：</p><ul><li>A) 将 <code>export</code> / <code>openModal</code> 事件的 payload 增加 <code>svg</code> 字符串（我可以实现并更新组件与文档）；</li><li>B) 把本页面加入 docs 左侧目录或导航（需要修改 docs 配置）；</li><li>C) 生成一个可运行的示例页面（playground/demo）； 请选择一个继续。</li></ul><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li>覆盖 <code>MermaidBlockNode</code>（在 <code>MarkdownRender</code> 中使用 <code>setCustomComponents</code>）的示例（中文）：<a href="./mermaid-block-node-override.html">覆盖 MermaidBlockNode（MarkdownRender 示例）</a></li></ul><p>Playground 示例：仓库包含一个可运行的 playground 页面演示如何拦截 <code>export</code> 并上传 <code>ev.svgString</code> —— 路由: <code>mermaid-export-demo</code> (文件：<code>playground/src/pages/mermaid-export-demo.vue</code>)。</p>`,23)])])}const E=i(t,[["render",n]]);export{c as __pageData,E as default};
