import{_ as i,c as e,o as a,ag as n}from"./chunks/framework.C0wiDQbp.js";const k=JSON.parse('{"title":"排查问题","description":"","frontmatter":{},"headers":[],"relativePath":"zh/guide/troubleshooting.md","filePath":"zh/guide/troubleshooting.md"}'),t={name:"zh/guide/troubleshooting.md"};function o(l,s,d,p,c,r){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="排查问题" tabindex="-1">排查问题 <a class="header-anchor" href="#排查问题" aria-label="Permalink to &quot;排查问题&quot;">​</a></h1><p>如果出现问题，请尝试下面这些通用解决方案：</p><ul><li>在 SSR 中出现 <code>window is not defined</code>：在 Nuxt 中将客户端代码包装为 <code>&lt;client-only&gt;</code>，在 Vite SSR 场景中用 <code>onMounted</code> 延迟初始化。</li><li>数学渲染失败：安装并引入 <code>katex</code>，同时在应用入口引入 <code>katex/dist/katex.min.css</code>。</li><li>Mermaid 渲染问题：升级到 <code>mermaid</code> &gt;= 11，检查异步渲染日志。</li><li>若通过 CDN <code>&lt;script&gt;</code> 引入 KaTeX/Mermaid：确保首次渲染前 <code>window.katex</code> / <code>window.mermaid</code> 已就绪；或在加载完成后调用一次 <code>setKatexLoader(() =&gt; window.katex)</code> / <code>setMermaidLoader(() =&gt; window.mermaid)</code> 来重置 loader。</li><li>性能问题：确认 <code>viewportPriority</code> 已启用，避免在单次 mount 中渲染大量重资产节点。</li></ul><h2 id="常见问题-faq" tabindex="-1">常见问题（FAQ） <a class="header-anchor" href="#常见问题-faq" aria-label="Permalink to &quot;常见问题（FAQ）&quot;">​</a></h2><ul><li><p>Tailwind / CSS 覆盖样式：当项目使用 Tailwind 或组件库（如 shadcn）时，Tailwind 的工具类或全局样式可能会覆盖库本身的样式。请参考 Tailwind 集成指南以了解样式导入顺序和解决策略：<code>/zh/guide/tailwind</code>。</p><p>快速修复：</p><ul><li>将 <code>markstream-vue/index.css</code> 放进 <code>@layer components { ... }</code>（详见 Tailwind 页面），稳定 CSS 顺序。</li><li>Tailwind 里设置 <code>prefix</code>（例如 <code>tw-</code>）减少与组件库 class 冲突。</li><li>用容器选择器或 <code>:deep</code> 把覆盖范围限制在渲染区域。</li></ul><p>说明：<code>markstream-vue</code> 的打包 CSS 会限定在内部 <code>.markstream-vue</code> 容器下（包含主题变量与 Tailwind 工具类），因此大多数冲突通常来自 reset/导入顺序在渲染区域内的覆盖，而不是库在全局“泄漏”样式。</p></li><li><p>自定义样式：你可以通过覆盖 <code>src/index.css</code> 中的 CSS 变量来自定义外观（例如 <code>--vscode-editor-background</code>、<code>--vscode-editor-foreground</code>），或在你的应用样式中覆盖组件类。推荐使用 <code>@apply</code> 或将自定义样式限定到某个容器内。</p></li><li><p>插槽优先：如果你需要更改组件内布局，先检查组件是否暴露了插槽（例如 <code>header-left</code>、<code>header-right</code>、<code>loading</code>）。插槽提供稳健的扩展点，无需替换组件内部实现。</p></li><li><p>还是不够？试试 <code>setCustomComponents(id, mapping)</code> 将节点渲染器替换为你自己的 Vue 组件，详见 <code>Advanced</code> 页面的示例；记得在 SPA 中及时 <code>removeCustomComponents</code> 清理映射以避免内存泄露。</p><p>快速示例（将 <code>code_block</code> 节点替换为自定义渲染器）：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setCustomComponents } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;markstream-vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCustomComponents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-docs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  code_block: MyCustomCodeBlock,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>这将告知所有带有 <code>custom-id=&quot;my-docs&quot;</code> 的 <code>MarkdownRender</code> 实例，使用 <code>MyCustomCodeBlock</code> 渲染 <code>code_block</code> 节点；更多示例请参见 <code>Advanced</code> 页面。</p></li><li><p>重现与提单：遇到渲染异常或报错时，请先在 <code>playground</code> 中尝试复现问题并提供最小 Markdown 示例（或使用托管的快速测试页面）。可以运行 <code>pnpm test</code> 进行本地测试以确认是否为回归问题。打开 issue 时请包含：</p><ol><li>可复现的最小 Markdown 示例（粘贴在 issue 中或放到 gist）。</li><li>在 playground 的复现步骤或 <code>playground</code> 链接，以及运行环境信息（浏览器、Node 版本、Vite/Nuxt）。</li><li>错误堆栈或 console 输出。</li></ol><p>优先提供一个 <code>playground</code> 对应的复现链接；你也可以使用托管的快速测试以便快速调试：</p><p><a href="https://markstream-vue.simonhe.me/test" target="_blank" rel="noreferrer">https://markstream-vue.simonhe.me/test</a></p><p>如果准备好了，使用快速创建 issue 链接：</p><p><a href="https://github.com/Simon-He95/markstream-vue/issues/new?template=bug_report.yml" target="_blank" rel="noreferrer">https://github.com/Simon-He95/markstream-vue/issues/new?template=bug_report.yml</a></p><p>额外建议：如果你可以编写一个单测或集成测试来复现 bug，请将其放入 <code>test/</code> 文件夹并在本地运行 <code>pnpm test</code>，这通常能帮助维护者快速定位并修复回归。</p></li></ul><h2 id="css-looks-wrong-start-here" tabindex="-1">样式错乱？先做这几件事 <a class="header-anchor" href="#css-looks-wrong-start-here" aria-label="Permalink to &quot;样式错乱？先做这几件事 {#css-looks-wrong-start-here}&quot;">​</a></h2><p>绝大部分渲染问题都源自 CSS 重置缺失、导入顺序不对，或者 Tailwind / UnoCSS 等工具类框架覆盖组件样式。提问前请按以下清单排查：</p><ol><li><strong>导入 reset</strong> —— 浏览器默认 <code>p</code>、<code>dl</code>、<code>table</code>、<code>pre</code> 的 margin/padding 各不相同。先引入 reset（<code>modern-css-reset</code>、<code>@unocss/reset</code>、<code>@tailwind base</code>），再引入 <code>markstream-vue</code>：</li></ol><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;modern-css-reset&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@tailwind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@tailwind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> components;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;markstream-vue/index.css&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ol start="2"><li><strong>使用 CSS layer</strong> —— Tailwind/UnoCSS 在 <code>@layer components</code>/<code>utilities</code> 中输出工具类，如果包的 CSS 在这些 layer 之前导入，样式可能被覆盖。把库的样式包裹在 layer 里：</li></ol><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@layer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> components {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  @import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;markstream-vue/index.css&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>UnoCSS 也可以通过 <code>preflights</code> 注入：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, presetUno } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unocss&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  presets: [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">presetUno</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  preflights: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      layer: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;components&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      getCSS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@import &quot;markstream-vue/index.css&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><ol start="3"><li><p><strong>确认同伴 CSS</strong> —— Monaco、KaTeX、Mermaid 都有自己的样式文件。缺少时会表现为空白编辑器或无样式公式。对照组件指南确认已引入对应 CSS。</p></li><li><p><strong>用 <code>custom-id</code> 限定覆盖范围</strong> —— 集成到大型设计系统时，其他全局样式可能影响渲染器。给 <code>MarkdownRender</code> 传 <code>custom-id=&quot;docs&quot;</code>，再通过 <code>[data-custom-id=&quot;docs&quot;]</code> 编写覆盖，可避免污染其它页面。</p></li></ol><p>如果上述步骤仍无法解决，请使用 <code>pnpm play</code> 启动 playground，准备一个只包含 CSS/Markdown 的最小示例并附带链接提 issue。</p>`,15)])])}const g=i(t,[["render",o]]);export{k as __pageData,g as default};
